var chatboxFocus=new Array,chatBoxes=new Array,ready=function(){chatBox={chatWith:function(t,o){chatBox.createChatBox(t,o),$("#chatbox_"+o+" .chatboxtextarea").focus()},close:function(t){$("#chatbox_"+t).css("display","none"),chatBox.restructure()},notify:function(){var t=$("#chatAudio")[0];t.play()},restructure:function(){align=0;for(x in chatBoxes)chatbox_id=chatBoxes[x],"none"!=$("#chatbox_"+chatbox_id).css("display")&&align++},createChatBox:function(t,o,a){if($("#chatbox_"+o).length>0)return"none"==$("#chatbox_"+o).css("display")&&($("#chatbox_"+o).css("display","block"),$(".chatbox").each(function(){var t=$(this);"none"!=$("#chatbox_"+t.data("cid")).css("display")&&t.data("cid")!=o&&($("#chatbox_"+t.data("cid")).css("display","none"),$("#"+t.data("comid")).removeClass("closeChat").addClass("btn btn-default btn-xs start-conversation"))})),void $("#chatbox_"+o+" .chatboxtextarea").focus();$(".chat_"+t).append('<div id="chatbox_'+o+'" class="chatbox" data-cid="'+o+'" data-comid="'+t+'"></div>'),$(".chatbox").each(function(){var a=$(this);"none"!=$("#chatbox_"+a.data("cid")).css("display")&&a.data("cid")!=o&&($("#chatbox_"+a.data("cid")).css("display","none"),$("#"+t).removeClass("closeChat").addClass("btn btn-default btn-xs start-conversation"))}),$.get("conversations/"+o,function(t){$("#chatbox_"+o).html(t),$("#chatbox_"+o+" .chatboxcontent").scrollTop($("#chatbox_"+o+" .chatboxcontent")[0].scrollHeight)},"html"),$("#chatbox_"+o).css("position","absolute"),chatBoxeslength=0;for(x in chatBoxes)"none"!=$("#chatbox_"+chatBoxes[x]).css("display")&&chatBoxeslength++;if(chatBoxes.push(o),1==a){for(minimizedChatBoxes=new Array,$.cookie("chatbox_minimized")&&(minimizedChatBoxes=$.cookie("chatbox_minimized").split(/\|/)),minimize=0,j=0;j<minimizedChatBoxes.length;j++)minimizedChatBoxes[j]==o&&(minimize=1);1==minimize&&($("#chatbox_"+o+" .chatboxcontent").css("display","none"),$("#chatbox_"+o+" .chatboxinput").css("display","none"))}chatboxFocus[o]=!1,$("#chatbox_"+o+" .chatboxtextarea").blur(function(){chatboxFocus[o]=!1,$("#chatbox_"+o+" .chatboxtextarea").removeClass("chatboxtextareaselected")}).focus(function(){chatboxFocus[o]=!0,$("#chatbox_"+o+" .chatboxhead").removeClass("chatboxblink"),$("#chatbox_"+o+" .chatboxtextarea").addClass("chatboxtextareaselected")}),$("#chatbox_"+o).click(function(){"none"!=$("#chatbox_"+o+" .chatboxcontent").css("display")&&$("#chatbox_"+o+" .chatboxtextarea").focus()}),$("#chatbox_"+o).show()},checkInputKey:function(t,o,a){13==t.keyCode&&0==t.shiftKey&&(t.preventDefault(),message=o.val(),message=message.replace(/^\s+|\s+$/g,""),""!=message&&($("#conversation_form_"+a).submit(),$(o).val(""),$(o).focus(),$(o).css("height","44px")));var e=o.clientHeight,c=94;c>e?(e=Math.max(o.scrollHeight,e),c&&(e=Math.min(c,e)),e>o.clientHeight&&$(o).css("height",e+8+"px")):$(o).css("overflow","auto")},toggleChatBoxGrowth:function(t){if("none"==$("#chatbox_"+t+" .chatboxcontent").css("display")){var o=new Array;$.cookie("chatbox_minimized")&&(o=$.cookie("chatbox_minimized").split(/\|/));var a="";for(i=0;i<o.length;i++)o[i]!=t&&(a+=t+"|");a=a.slice(0,-1),$.cookie("chatbox_minimized",a),$("#chatbox_"+t+" .chatboxcontent").css("display","block"),$("#chatbox_"+t+" .chatboxinput").css("display","block"),$("#chatbox_"+t+" .chatboxcontent").scrollTop($("#chatbox_"+t+" .chatboxcontent")[0].scrollHeight)}else{var a=t;$.cookie("chatbox_minimized")&&(a+="|"+$.cookie("chatbox_minimized")),$.cookie("chatbox_minimized",a),$("#chatbox_"+t+" .chatboxcontent").css("display","none"),$("#chatbox_"+t+" .chatboxinput").css("display","none")}}},jQuery.cookie=function(t,o,a){if("undefined"==typeof o){var e=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),i=0;i<c.length;i++){var n=jQuery.trim(c[i]);if(n.substring(0,t.length+1)==t+"="){e=decodeURIComponent(n.substring(t.length+1));break}}return e}a=a||{},null===o&&(o="",a.expires=-1);var s="";if(a.expires&&("number"==typeof a.expires||a.expires.toUTCString)){var h;"number"==typeof a.expires?(h=new Date,h.setTime(h.getTime()+24*a.expires*60*60*1e3)):h=a.expires,s="; expires="+h.toUTCString()}var x=a.path?"; path="+a.path:"",r=a.domain?"; domain="+a.domain:"",b=a.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(o),s,x,r,b].join("")}};$(document).ready(ready),$(document).on("page:load",ready);